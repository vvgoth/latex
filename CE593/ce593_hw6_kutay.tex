\documentclass[a4paper, 11pt]{article}
\usepackage[letterpaper,margin=0.8in]{geometry}
\usepackage[T1]{fontenc}
\usepackage{blindtext}
\usepackage{lastpage}
\usepackage{fancyhdr}
\usepackage{xcolor}
\usepackage{setspace}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{matlab-prettifier}
\usepackage{float}
\usepackage[small,bf,hypcap=true]{caption}

\newenvironment{Figure}
  {\par\medskip\noindent\minipage{\linewidth}
   \captionsetup{type=figure}}
  {\endminipage\par\medskip}
\usepackage[hidelinks]{hyperref}
\usepackage{titlesec}
\usepackage{tocloft}

\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}

\graphicspath{{./Figures}}

% Configure the header
\pagestyle{fancy} % Enable fancy headers
\fancyhead[L]{CE 593} % Left-aligned header
\fancyhead[C]{Statistical Analysis in Coastal Engineering} % Centered header
\fancyhead[R]{03/01/2026} % Right-aligned header

\setlength{\floatsep}{6pt plus 2pt minus 2pt}      % space between floats
\setlength{\textfloatsep}{8pt plus 2pt minus 2pt}  % space between floats and text
\setlength{\intextsep}{8pt plus 2pt minus 2pt}     % space above and below in-text floats

\onehalfspacing

\begin{document}

\titleformat{\section}
  {\normalfont\bfseries\fontsize{12}{10}\selectfont}
  {\large\thesection.} 
  {0.3em}
  {}

\thispagestyle{empty}

\begin{figure}[H]
    \vspace{0.6cm}
    \centering
    \includegraphics[width=0.45\textwidth]{logo.png}
\end{figure}
\vspace{0.8cm}

\begin{center}
    \textbf{\LARGE Middle East Technical University}
    \vspace{0.3cm}

    \textbf{\LARGE Department of Civil Engineering}
    \vspace{0.5cm}

    \textbf{\Large 2025-2026 Fall Semester}
    \vspace{1.5cm}

    \textbf{\Large CE593 Statistical Analysis in Coastal Engineering}
    \vspace{0.9cm}

    \textbf{\LARGE Homework \#6}
    \vspace{1.5cm}

    \large Instructor:

    \large Assoc.Prof.Dr. CÃ¼neyt Baykal
    \vspace{1.2cm}

    \large Submitted by:
    
    \large Bilge Kutay

    \large 2511798

\end{center}

\newpage
\renewcommand{\contentsname}{Table of Contents} 
\begin{center}
    \tableofcontents
\end{center}
\newpage

\listoffigures
\listoftables
\newpage

\section{Introduction}

\hspace*{0.5cm}Extreme wave statistics are crucial for the design and safety assessment of coastal and offshore structures, as rare events often govern the design and safety criteria. Since extreme waves occur infrequently, their
estimation cannot rely solely on observed data. Instead, statistical models are used to obtain reliable estimates of extreme wave heights and periods. 

In this study, a synthetic dataset representing 30 years of annual maximum
significant wave heights is analyzed using two commonly applied extreme value
distributions: the Gumbel Type I (FT-Ia) distribution and the Weibull distribution with a fixed shape parameter of $k = 1.4$. The objective is to fit these distributions to the data, evaluate their goodness-of-fit using various statistical tests, and estimate the 100-year return value of significant wave height along with confidence intervals.

The suitability of each distribution is evaluated using multiple goodness-of-fit criteria, including the Kolmogorov-Smirnov test, the coefficient of determination, and several additional statistical consistency checks. Uncertainty in the estimates is quantified through confidence intervals on the probability plots and return value calculations.

\section{Methodology}

\subsection{Dataset Description and Ranking}

\hspace*{0.5cm}The dataset consists of 30 synthetic annual maximum significant wave heights (Hs) generated uniformly between 3.5 m and 6.5 m. The values are assumed to represent independent observations of extreme wave heights over a 30-year period.  

For the purpose of probability plotting, the data are first arranged in
descending order, such that the largest observed wave height corresponds to
the lowest non-exceedance probability. Let $H_{s,i}$ denote the $i$-th ranked
wave height, where $i = 1$ corresponds to the maximum value and $i = N$
corresponds to the minimum value, with $N = 30$.

Non-exceedance probabilities are assigned to each ranked value using a
general plotting-position formula of the form

\begin{equation}
F_i = 1 - \frac{i - \alpha}{N + \beta}
\end{equation}

where $\alpha$ and $\beta$ are distribution-dependent constants. These
probabilities provide the basis for creating the extreme value distributions considered in the following sections.

\subsection{Probability Distribution Fitting}

\subsubsection{Gumbel FT-Ia Distribution}

\hspace{0.5cm}The Gumbel Type I distribution is frequently used in extreme value analysis to describe annual maximum wave heights. For the FT-Ia formulation, non-exceedance probabilities are assigned to the data using

\begin{equation}
F_i = 1 - \frac{i - \alpha}{N + \beta}
\end{equation}

where $i$ denotes the rank of the data point, $N$ is the sample size, and the
constants are taken as $\alpha = 0$ and $\beta = 1$.

The reduced variate for the Gumbel distribution is defined as

\begin{equation}
y_i = -\ln\!\left[-\ln(F_i)\right]
\end{equation}

A linear relationship between the reduced variate and the significant wave
height is assumed in the form

\begin{equation}
H_{s,i} = Ay_i + B
\end{equation}

where $A$ and $B$ denote the scale and location parameters of the distribution.

The parameters are obtained by least-squares fitting. Denoting the reduced
variate and wave height by $y_i$ and $H_{s,i}$, respectively, the slope and
intercept of the fitted line are given by

\begin{equation}
A = \frac{\mathrm{Cov}(H_s, y)}{\mathrm{Var}(y)}, \qquad
B = \overline{H_s} - A\,\overline{y}
\end{equation}

where $\overline{(\cdot)}$ denotes the sample mean.

\subsubsection{Weibull Distribution ($k = 1.4$)}

\hspace{0.5cm}In addition to the Gumbel distribution, the dataset is also analyzed using the Weibull distribution with a fixed shape parameter of $k = 1.4$. Non-exceedance probabilities are assigned to the ranked data using

\begin{equation}
F_i = 1 - \frac{i - 0.72}{N + 0.3944}
\end{equation}

where $i$ denotes the rank, $N$ is the sample size.

For the Weibull distribution, the reduced variate is defined as

\begin{equation}
y_i = \left[-\ln(1 - F_i)\right]^{1/k}
\end{equation}

As in the Gumbel case, a linear relationship is assumed between the reduced
variate and the significant wave height,

\begin{equation}
H_{s,i} = Ay_i + B
\end{equation}

The distribution parameters $A$ and $B$ are obtained by least-squares fitting
of the linear model in reduced variate space, using the same procedure as
described for the Gumbel FT-Ia distribution.

\subsection{Goodness-of-Fit Tests}

\subsubsection{Kolmogorov-Smirnov Test}

\hspace{0.5cm}The Kolmogorov-Smirnov (KS) test is used to assess the agreement between the empirical distribution of the data and the theoretical cumulative distribution function of the fitted model. The empirical distribution is represented by the step functions
\begin{equation}
S_1 = \frac{i - 1}{N}, \qquad
S_2 = \frac{i}{N}
\end{equation}

where $i$ denotes the rank of the data point and $N$ is the sample size.

For a given fitted distribution with theoretical cumulative distribution
function $F(H_s)$, the KS test statistic is defined as
\begin{equation}
D = \max \left( \max(F - S_1), \max(S_2 - F) \right)
\end{equation}

The fitted distribution is considered acceptable if the test statistic $D$
is smaller than the critical value corresponding to the selected significance
level and sample size.

\subsubsection{Coefficient of Determination ($R^2$ Test)}

\hspace{0.5cm}The quality of the linear fit in the probability plot is also evaluated using the coefficient of determination, $R^2$. This measure quantifies the degree of linear association between the reduced variate and the significant wave height.

The correlation coefficient $r$ is calculated as
\begin{equation}
r = \frac{\mathrm{Cov}(H_s, y)}{\sqrt{\mathrm{Var}(H_s)\,\mathrm{Var}(y)}}
\end{equation}

and the coefficient of determination is defined by
\begin{equation}
R^2 = r^2
\end{equation}

A value of $R^2$ close to 1 indicates a strong linear relationship, suggesting a good fit of the distribution to the data.

\subsubsection{MIR Criterion}

\hspace{0.5cm}In addition to the $R^2$ test, the Model Information Ratio (MIR) criterion is employed to further assess the goodness-of-fit. The MIR is based on the deviation of the correlation coefficient from unity, normalized by its expected mean value.

The deviation of the correlation coefficient is defined as
\begin{equation}
\Delta r = 1 - r
\end{equation}

The expected mean deviation is expressed as
\begin{equation}
\Delta r_{\text{mean}} = \exp\!\left( a + b \ln N + c (\ln N)^2 \right)
\end{equation}
where $N$ is the sample size and the coefficients $a$, $b$, and $c$ depend on
the distribution type and the number of data.

The MIR criterion is then defined as
\begin{equation}
\text{MIR} = \frac{\Delta r}{\Delta r_{\text{mean}}}
\end{equation}

A MIR value close to 1 indicates that the fit is consistent with the expected statistical behavior.

\subsubsection{DOL Criterion}

\hspace{0.5cm}The Deviation of the Largest Observation (DOL) criterion is used to examine whether the largest observed value in the dataset is statistically consistent with the fitted distribution. The test is based on the standardized distance between the maximum observation and the sample mean.

The DOL parameter is defined as
\begin{equation}
\xi = \frac{H_{s,\max} - \overline{H_s}}{s^2}
\end{equation}
where $H_{s,\max}$ denotes the largest observed significant wave height,
$\overline{H_s}$ is the sample mean, and $s^2$ is the sample variance.

Upper and lower bounds for the DOL parameter are expressed as functions of the
sample size in the form
\begin{equation}
\xi_{95} = a_U + b_U \ln N + c_U (\ln N)^2, \qquad
\xi_{5} = a_L + b_L \ln N + c_L (\ln N)^2
\end{equation}
where the coefficients $a$, $b$, and $c$ depend on the assumed distribution and
the number of data.

The fitted distribution is considered acceptable if the DOL parameter lies within the calculated bounds, $\xi_5 < \xi < \xi_{95}$.

\subsubsection{REC Criterion}

\hspace{0.5cm}The Relative Error of the Correlation coefficient (REC) criterion is used to evaluate the reliability of the correlation coefficient obtained from the probability plot. The REC criterion compares the deviation of the correlation coefficient to its expected 95th percentile value.

The deviation of the correlation coefficient is defined as
\begin{equation}
\Delta r = 1 - r
\end{equation}

The upper bound for the acceptable deviation is expressed as
\begin{equation}
\Delta r_{95} = \exp\!\left( a + b \ln N + c (\ln N)^2 \right)
\end{equation}
where $N$ is the sample size and the coefficients $a$, $b$, and $c$ depend on the distribution type and the number of data.

The fitted distribution is considered acceptable according to the REC criterion
if the deviation of the correlation coefficient does not exceed the calculated upper bound, $\Delta r < \Delta r_{95}$.

\subsection{Confidence Bounds on Probability Plots}

\hspace{0.5cm}Uncertainty associated with the fitted probability distributions is quantified by calculating confidence bounds on the probability plots. These bounds account for sampling variability and depend on the sample size and the selected confidence level.

The standard deviation of the fitted wave height is expressed as
\begin{equation}
\sigma_X = \sigma_z \, \sigma_{H_s}
\end{equation}
where $\sigma_{H_s}$ denotes the sample standard deviation of the ranked wave
heights and $\sigma_z$ represents the standard deviation of the reduced variate.

The reduced variate standard deviation is given by
\begin{equation}
\sigma_z = \frac{\sqrt{1 + a \left( y - c + \alpha \ln v \right)^2}}{\sqrt{N}}
\end{equation}
where $N$ is the sample size, $v$ is the number of fitted parameters, and the
coefficients $a$, $c$, and $\alpha$ depend on the assumed distribution\dots

For a specified confidence level, the upper and lower confidence bounds are
computed as
\begin{equation}
H_{s,U} = H_{s,\text{fit}} + CI \, \sigma_X
\end{equation}
and
\begin{equation}
H_{s,L} = H_{s,\text{fit}} - CI \, \sigma_X
\end{equation}
where $H_{s,\text{fit}}$ denotes the fitted wave height and $CI$ is the standard normal variate corresponding to the selected confidence level.

\subsection{Return Value Estimation}

\hspace{0.5cm}Extreme return values are estimated by extrapolating the fitted probability
distributions to specified return periods. For a return period $R$, the
corresponding non-exceedance probability is defined as
\begin{equation}
F_R = 1 - \frac{1}{R}
\end{equation}

The reduced variate associated with the return period is obtained by evaluating
the reduced variate expressions of the fitted distribution at $F = F_R$. For the
Gumbel FT-Ia distribution, the reduced variate is given by
\begin{equation}
y_R = -\ln\!\left[-\ln(F_R)\right]
\end{equation}
while for the Weibull distribution it is expressed as
\begin{equation}
y_R = \left[-\ln(1 - F_R)\right]^{1/k}
\end{equation}

The return significant wave height is then obtained from the linear model
\begin{equation}
H_{s,R} = Ay_R + B
\end{equation}

Confidence intervals for the return value are constructed using the same approach as the probability plots, evaluating the standard deviation at the return period reduced variate and applying the corresponding confidence bounds.

\section{Results}

\hspace{0.5cm}This section presents the results obtained from the application of the extreme value analysis methods described in the previous section. The fitted probability distributions are first examined using probability plots with confidence intervals. The outcomes of the goodness-of-fit tests are then summarized, and finally the estimated extreme return values are reported.

\subsection{Probability Plots and Confidence Intervals}

\hspace{0.5cm}Probability plots for the Gumbel FT-Ia and Weibull distributions are constructed using the fitted linear models in reduced variate space. The ranked significant wave heights are plotted against their corresponding reduced variates, together with the fitted straight lines.

Confidence intervals corresponding to 70\% and 90\% confidence levels are added
to the probability plots using the formulation described in Section~2.4. These
intervals provide a visual indication of the uncertainty associated with the
fitted distributions, particularly in the upper tail where extrapolation is
required.

Figure~\ref{fig:gumbel_ci} presents the Gumbel FT-Ia probability plot together
with the fitted linear model and the corresponding confidence bounds. The data
points show a reasonable alignment with the fitted line, and the confidence intervals indicate the expected variability due to sampling uncertainty.

Figure~\ref{fig:weibull_ci} shows the Weibull probability plot with $k = 1.4$,
including the fitted line and confidence bounds. A similar overall agreement is
observed.

\begin{figure}[H]
\centering
\includegraphics[width=0.85\textwidth]{gumbel_ci}
\caption{Gumbel FT-Ia probability plot with fitted linear model and
70\% and 90\% confidence bounds}
\label{fig:gumbel_ci}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=0.85\textwidth]{weibull_ci}
\caption{Weibull probability plot ($k = 1.4$) with fitted linear model and
70\% and 90\% confidence bounds}
\label{fig:weibull_ci}
\end{figure}

\subsection{Goodness-of-Fit Test Results}

\hspace{0.5cm}The goodness-of-fit of the Gumbel FT-Ia and Weibull distributions is evaluated using a variety of statistical tests, as described in Section~2.3. Together, these tests provide complementary information
on the agreement between the fitted distributions and the observed data.

Figure~\ref{fig:ks_weibull} presents the Kolmogorov--Smirnov comparison between
the empirical cumulative distribution and the fitted Weibull distribution. In
the analysis, deviations with respect to both the lower and upper empirical
bounds are evaluated, and the test statistic is taken as the maximum of these
values. For clarity, only the upper empirical bound is shown in the figure.

For the present dataset, the maximum deviation remains below the critical
value, and the fitted distribution satisfies the KS criterion.

\begin{figure}[H]
\centering
\includegraphics[width=0.75\textwidth]{ks_weibull}
\caption{Kolmogorov--Smirnov test for the Weibull distribution ($k = 1.4$),
showing the empirical cumulative distribution and the fitted theoretical
distribution}
\label{fig:ks_weibull}
\end{figure}

The numerical results of all goodness-of-fit tests are summarized in
Table~\ref{tab:gof}. Both distributions pass the Kolmogorov--Smirnov test and
satisfy the DOL and REC criteria, indicating overall statistical consistency
with the observed dataset.

Differences between the two models are more apparent in the correlation-based
measures. The Gumbel FT-Ia distribution yields a higher coefficient of
determination, indicating a slightly stronger linear relationship in reduced
variate space. In addition, the MIR value obtained for the Gumbel distribution
is closer to 1, whereas the Weibull distribution exhibits a larger MIR
value, suggesting a comparatively weaker performance according to this
criterion.

\begin{table}[H]
\centering
\caption{Summary of goodness-of-fit test results}
\label{tab:gof}
\begin{tabular}{lcc}
\hline
Criterion & Gumbel FT-Ia & Weibull ($k = 1.4$) \\
\hline
KS statistic $D$      & 0.1229 & 0.1388 \\
KS test result        & Pass   & Pass   \\
$R^2$                 & 0.9401 & 0.9187 \\
MIR                   & 0.9065 & 2.2169 \\
DOL criterion         & Pass   & Pass   \\
REC criterion         & Pass   & Pass   \\
\hline
\end{tabular}
\end{table}


\subsection{Extreme Return Value Estimates}

\hspace{0.5cm}The 100-year return significant wave height is estimated for both distributions
using the fitted models described in Section~2.5. Confidence intervals
corresponding to 70\% and 90\% confidence levels are computed using the same
uncertainty formulation adopted for the probability plots.

The estimated return values and confidence intervals are summarized in
Table~\ref{tab:return}. The Gumbel FT-Ia distribution yields a higher estimate
of the 100-year return significant wave height compared to the Weibull
distribution. At the same time, the associated confidence intervals are
slightly narrower, indicating a more concentrated estimate of extreme wave
heights.

The Weibull distribution produces a lower 100-year return value together with
slightly wider confidence intervals. This reflects a less conservative return
estimate compared to the Gumbel distribution with greater uncertainty in the upper tail.

\begin{table}[H]
\centering
\caption{Estimated 100-year return significant wave height and confidence intervals}
\label{tab:return}
\begin{tabular}{lccc}
\hline
Distribution & $H_{s,100}$ (m) & 70\% CI (m) & 90\% CI (m) \\
\hline
Gumbel FT-Ia      & 8.003 & [7.318 , 8.688] & [6.916 , 9.090] \\
Weibull ($k=1.4$) & 7.653 & [6.957 , 8.349] & [6.549 , 8.758] \\
\hline
\end{tabular}
\end{table}

\section{Discussion and Conclusion}

\hspace{0.5cm}The extreme value analysis carried out in this study indicates that both the Gumbel FT-Ia and Weibull distributions provide an acceptable representation of the specific 30-year dataset of annual maximum significant wave heights considered. For this dataset, all applied goodness-of-fit criteria are satisfied, indicating statistical consistency between the fitted models and the observed data.

Although both distributions pass the applied tests, differences between the models become apparent when individual criteria are examined in detail. The Gumbel FT-Ia distribution exhibits a slightly higher coefficient of determination and a MIR value closer to unity, indicating a stronger linear fit in reduced variate space for the present dataset. Both distributions satisfy the DOL and REC criteria, suggesting that neither the largest observation nor the overall correlation structure is inconsistent with the assumed models.

Differences are also observed in the estimation of extreme return values. For
the analyzed dataset, the Gumbel FT-Ia distribution yields a higher estimate of the 100-year return significant wave height compared to the Weibull distribution. At the same time, the associated confidence intervals are slightly narrower, indicating a more concentrated estimate of extreme wave heights. The Weibull distribution produces a lower return level together with
slightly wider confidence intervals, reflecting greater uncertainty in the upper tail for this particular dataset.

It should be emphasized that these conclusions are conditional on the sample
size and statistical characteristics of the analyzed record. Different datasets, longer observation periods, or records with different variability may lead to different goodness-of-fit outcomes and return value estimates. Consequently, the relative performance of extreme value distributions should be evaluated on a case-by-case basis rather than assumed to be universally valid.

Overall, for the present dataset, both distributions are suitable for extreme
value analysis, while the Gumbel FT-Ia distribution provides a slightly more
conservative estimate of extreme wave heights with marginally lower uncertainty.

\newpage

\begin{thebibliography}{99}
\addcontentsline{toc}{section}{References}

\bibitem{Baykal2023}
Baykal, C. (2023). \textit{Lecture notes for CE 593 Statistical analysis in coastal engineering.} Middle East Technical University.


\end{thebibliography}
\newpage

\appendix
\section{Appendix}

\section*{MATLAB Code:}
\begin{lstlisting}[frame=single, numbers=left, style=Matlab-Pyglike]
clc; clear;

% Parameters
N     = 30;
Hsmin = 3.5;
Hsmax = 6.5;

rng(1);
Hs = Hsmin + (Hsmax - Hsmin) * rand(N,1);

Hs_desc = sort(Hs, 'descend');

i = (1:N)';

% Gumbel FT-Ia
alpha_g = 0;
beta_g  = 1;

F_g = 1 - (i - alpha_g) ./ (N + beta_g);
y_g = -log( -log(F_g) );

x = Hs_desc;

Ybar_g = (1/N) * sum(y_g);
Xbar_g = (1/N) * sum(x);

VarY_g = (1/N) * sum( (y_g - Ybar_g).^2 );
VarX_g  = (1/N)*sum( (x - Xbar_g).^2 );
CovYX_g = (1/N) * sum( (y_g - Ybar_g) .* (x - Xbar_g) );

A_g = CovYX_g / VarY_g;
B_g = Xbar_g - A_g * Ybar_g;

% Weibull
k = 1.4;

alpha_w = 0.20 + 0.27 / sqrt(k);
beta_w  = 0.20 + 0.23 / sqrt(k);

F_w = 1 - (i - alpha_w) ./ (N + beta_w);
y_w = ( -log(1 - F_w) ).^(1/k);

Ybar_w = (1/N) * sum(y_w);
Xbar_w = (1/N) * sum(x);

VarY_w  = (1/N) * sum( (y_w - Ybar_w).^2 );
VarX_w  = (1/N)*sum( (x - Xbar_w).^2 );
CovYX_w = (1/N) * sum( (y_w - Ybar_w) .* (x - Xbar_w) );

A_w = CovYX_w / VarY_w;
B_w = Xbar_w - A_w * Ybar_w;

%% Kolmogorov-Smirnov Test
Hs_asc = sort(Hs);
i_asc = (1:N)';

S1 = (i_asc - 1) / N;
S2 = i_asc / N;

% Gumbel FT-Ia
F_g_theo = exp( -exp( -(Hs_asc - B_g) / A_g ) );

Dg_1 = F_g_theo - S1;
Dg_2 = S2 - F_g_theo;

D_KS_g = max( max(Dg_1), max(Dg_2) );

% Weibull
F_w_theo = 1 - exp( -((Hs_asc - B_w) ./ A_w).^k );

Dw_1 = F_w_theo - S1;
Dw_2 = S2 - F_w_theo;

D_KS_w = max( max(Dw_1), max(Dw_2) );

d_crit = 0.24;

pass_g = D_KS_g < d_crit;
pass_w = D_KS_w < d_crit;

figure; hold on;

plot(Hs_asc, F_w_theo, 'b-', 'LineWidth',1.5);

for j = 1:N
    plot([Hs_asc(j) Hs_asc(j)], [S1(j) S2(j)], 'k--', 'LineWidth',1.2);
    
    if j < N
        plot([Hs_asc(j) Hs_asc(j+1)], [S2(j) S2(j)], 'k--', 'LineWidth',1.2);
    end
end

grid on;
xlabel('H_s (m)');
ylabel('Cumulative probability');
title('KS Test - Weibull (k = 1.4)');

legend('F(x) theoretical','S(x) empirical','Location','southeast');

%% R^2 Test
% Gumbel FT-Ia
r_g  = CovYX_g / sqrt(VarX_g*VarY_g);
R2_g = r_g^2;

% Weibull
r_w  = CovYX_w / sqrt(VarX_w*VarY_w);
R2_w = r_w^2;

%% MIR Test
v = 1;

% Gumbel FT-Ia 
a_gM = -2.364 + 0.54*(v^(5/2));
b_gM = -0.2665 - 0.0457*(v^(5/2));
c_gM = -0.044;

Delta_r_g = 1 - r_g;
Delta_rmean_g = exp(a_gM + b_gM*log(N) + c_gM*(log(N))^2);

MIR_g = Delta_r_g / Delta_rmean_g;

% Weibull
a_wM = -2.277 + 0.056*(v^(1/2));
b_wM = -0.3169 - 0.0499*v;
c_wM = -0.044;

Delta_r_w = 1 - r_w;
Delta_rmean_w = exp(a_wM + b_wM*log(N) + c_wM*(log(N))^2);

MIR_w = Delta_r_w / Delta_rmean_w;

%% DOL Test
x1 = Hs_desc(1);
xbar = (1/N)*sum(Hs_desc);
s2 = (1/N)*sum((Hs_desc - xbar).^2);

xi = (x1 - xbar) / s2;

% Gumbel FT-Ia
% Upper bound
aU_g = -0.579 + 0.468*v;
bU_g =  1.496 - 0.227*v^2;
cU_g = -0.038;

xi95_g = aU_g + bU_g*log(N) + cU_g*(log(N))^2;

% Lower bound
aL_g = 0.257 + 0.133*v^2;
bL_g = 0.452 - 0.118*v^2;
cL_g = 0.032;

xi5_g = aL_g + bL_g*log(N) + cL_g*(log(N))^2;

pass_DOL_g = (xi > xi5_g) && (xi < xi95_g);

% Weibull
% Upper bound
aU_w = -0.548 + 0.452*sqrt(v);
bU_w =  1.521 - 0.184*v;
cU_w = -0.065;

xi95_w = aU_w + bU_w*log(N) + cU_w*(log(N))^2;

% Lower bound
aL_w = 0.192 + 0.126*sqrt(v^3);
bL_w = 0.501 - 0.081*sqrt(v^3);
cL_w = 0.018;

xi5_w = aL_w + bL_w*log(N) + cL_w*(log(N))^2;

pass_DOL_w = (xi > xi5_w) && (xi < xi95_w);

%% REC Test
% Gumbel FT-Ia
a_g = -1.444;
b_g = -0.2733 + 0.0414*sqrt(v^5);
c_g = -0.045;

Delta_r95_g = exp( a_g + b_g*log(N) + c_g*(log(N))^2 );

pass_REC_g = Delta_r_g < Delta_r95_g;

% Weibull
a_w = -1.312;
b_w = -0.3356 - 0.0449*v;
c_w = -0.045;

Delta_r95_w = exp( a_w + b_w*log(N) + c_w*(log(N))^2 );

pass_REC_w = Delta_r_w < Delta_r95_w;

%% Test Results

fprintf('\n===== GOODNESS-OF-FIT RESULTS (N = %d) =====\n\n', N);

fprintf('--- Kolmogorov-Smirnov Test ---\n');
fprintf('Gumbel FT-Ia : D = %.4f  | Pass = %d\n', D_KS_g, pass_g);
fprintf('Weibull k=1.4: D = %.4f  | Pass = %d\n\n', D_KS_w, pass_w);

fprintf('--- Coefficient of Determination ---\n');
fprintf('Gumbel FT-Ia : R^2 = %.4f\n', R2_g);
fprintf('Weibull k=1.4: R^2 = %.4f\n\n', R2_w);

fprintf('--- MIR Criterion ---\n');
fprintf('Gumbel FT-Ia : MIR = %.4f\n', MIR_g);
fprintf('Weibull k=1.4: MIR = %.4f\n\n', MIR_w);

fprintf('--- DOL Criterion ---\n');
fprintf('Gumbel FT-Ia : Pass = %d\n', pass_DOL_g);
fprintf('Weibull k=1.4: Pass = %d\n\n', pass_DOL_w);

fprintf('--- REC Criterion ---\n');
fprintf('Gumbel FT-Ia : Pass = %d\n', pass_REC_g);
fprintf('Weibull k=1.4: Pass = %d\n\n', pass_REC_w);

%% Confidence bounds on probability plots
sigma_x = sqrt( (1/N)*sum((Hs_desc - mean(Hs_desc)).^2) );

z70 = norminv((1 + 0.70) / 2);
z90 = norminv((1 + 0.90) / 2);

% Gumbel FT-I
y_plot_g = linspace(min(y_g), max(y_g), 200);
x_fit_g  = A_g*y_plot_g + B_g;

a1_g = 0.64;
a2_g = 9.0;
kappa_g = 0.93;
c_g = 0;
alpha_g = 1.33;

a_g = a1_g * exp( a2_g*N^(-1.3) + kappa_g*(-log(v))^2 );

sigma_z_g = sqrt( 1 + a_g*(y_plot_g - c_g + alpha_g*log(v)).^2 ) / sqrt(N);
sigma_X_g = sigma_z_g * sigma_x;

x70U_g = x_fit_g + z70*sigma_X_g;
x70L_g = x_fit_g - z70*sigma_X_g;

x90U_g = x_fit_g + z90*sigma_X_g;
x90L_g = x_fit_g - z90*sigma_X_g;

figure; hold on; box on
plot(y_g, Hs_desc, 'ko', 'MarkerFaceColor','k')
plot(y_plot_g, x_fit_g, 'r-', 'LineWidth',1.8)
plot(y_plot_g, x70U_g, 'k--', y_plot_g, x70L_g, 'k--')
plot(y_plot_g, x90U_g, 'k:',  y_plot_g, x90L_g, 'k:')

grid on
xlabel('y = -ln[-ln(P)]')
ylabel('H_s (m)')
title('Gumbel FT-Ia Probability Plot with 70% and 90% Confidence Bounds')

legend('Data','Fitted line','70% CI','', '90% CI','', ...
       'Location','northwest')
% Weibull
y_plot_w = linspace(min(y_w), max(y_w), 200);
x_fit_w  = A_w*y_plot_w + B_w;

a1_w = 2.05;
a2_w = 11.4;
kappa_w = 0.69;
c_w = 0.4;
alpha_w = 0.72;

a_w = a1_w * exp( a2_w*N^(-1.3) + kappa_w*(-log(v))^2 );

sigma_z_w = sqrt( 1 + a_w*(y_plot_w - c_w + alpha_w*log(v)).^2 ) / sqrt(N);
sigma_X_w = sigma_z_w * sigma_x;

x70U_w = x_fit_w + z70*sigma_X_w;
x70L_w = x_fit_w - z70*sigma_X_w;

x90U_w = x_fit_w + z90*sigma_X_w;
x90L_w = x_fit_w - z90*sigma_X_w;

figure; hold on; box on
plot(y_w, Hs_desc, 'ko', 'MarkerFaceColor','k')
plot(y_plot_w, x_fit_w, 'b-', 'LineWidth',1.8)
plot(y_plot_w, x70U_w, 'k--', y_plot_w, x70L_w, 'k--')
plot(y_plot_w, x90U_w, 'k:',  y_plot_w, x90L_w, 'k:')

grid on
xlabel('y = [-ln(1 - F)]^{1/k}')
ylabel('H_s (m)')
title('Weibull Probability Plot with 70% and 90% Confidence Bounds')

legend('Data','Fitted line','70% CI','', '90% CI','', ...
       'Location','northwest')

%% 100-year return value with confidence intervals
R = 100;
F_R = 1 - 1/R;

%Gumbel FT-Ia
yR_g = -log( -log(F_R) );
XR_g = A_g*yR_g + B_g;

sigma_zR_g = sqrt( 1 + a_g*(yR_g - c_g + alpha_g*log(v))^2 ) / sqrt(N);
sigma_XR_g = sigma_zR_g * sigma_x;

XR_g_70 = [XR_g - z70*sigma_XR_g , XR_g + z70*sigma_XR_g];
XR_g_90 = [XR_g - z90*sigma_XR_g , XR_g + z90*sigma_XR_g];

% Weibull
yR_w = ( -log(1 - F_R) ).^(1/k);
XR_w = A_w*yR_w + B_w;

sigma_zR_w = sqrt( 1 + a_w*(yR_w - c_w + alpha_w*log(v))^2 ) / sqrt(N);
sigma_XR_w = sigma_zR_w * sigma_x;

XR_w_70 = [XR_w - z70*sigma_XR_w , XR_w + z70*sigma_XR_w];
XR_w_90 = [XR_w - z90*sigma_XR_w , XR_w + z90*sigma_XR_w];

% Results

fprintf('\n--- 100-YEAR RETURN VALUE ---\n\n');

fprintf('Gumbel FT-Ia:\n');
fprintf('H_s,100 = %.3f m\n', XR_g);
fprintf('70%% CI  = [%.3f , %.3f] m\n', XR_g_70(1), XR_g_70(2));
fprintf('90%% CI  = [%.3f , %.3f] m\n\n', XR_g_90(1), XR_g_90(2));

fprintf('Weibull (k = 1.4):\n');
fprintf('H_s,100 = %.3f m\n', XR_w);
fprintf('70%% CI  = [%.3f , %.3f] m\n', XR_w_70(1), XR_w_70(2));
fprintf('90%% CI  = [%.3f , %.3f] m\n\n', XR_w_90(1), XR_w_90(2));

\end{lstlisting}


\end{document}